<template>
  <div
    v-if="$auth.is()"
    class="workspace"
  >
    <w-header
      :user="$auth.user"
      :optional-add="hasPanes"
      @apps="showapps=true"
    />
    <!-- if user exists display interface -->
    <layout
      v-model="panes"
    />
    <app-selector
      :displayed="!hasPanes || showapps"
      :first-app="!hasPanes"
      :fullscreen="true"
      @close="showapps=false"
      @add-app="addTab"
    />
  </div>
</template>

<script>
import Header from 'corteza-webapp-one/src/components/Header.vue'
import Layout from 'corteza-webapp-one/src/components/Layout.vue'
import AppSelector from 'corteza-webapp-one/src/components/AppSelector.vue'

export default {
  components: {
    'w-header': Header,
    Layout,
    AppSelector,
  },

  data () {
    return {
      showapps: false,
    }
  },

  computed: {
    hasPanes: {
      get () {
        // this.$logger.log('currently : ' + this.$store.state.panes.items.length + ' panes')
        return (this.$store.state.panes.items.length > 0)
      },
    },

    panes: {
      get () {
        // this.$logger.log('WkS getting panes')
        return this.$store.state.panes
      },
      /*
      set (tabs) {
        this.$store.commit('panes/updateTabs', tabs);
      }
      */
    },
  },

  created () {
    this.$auth.check()
      .then((user) => {
        if (!user) {
          // check performed: no error & no user,
          // redirect to auth
          throw new Error()
        }
      })
      .catch(() => {
        this.$auth.open()
      })
  },

  methods: {
    addTab (appData) {
      this.$store.commit('panes/addApp', appData)
    },

    connect () {
      this.$store.commit('user/connectUser')
    },
  },
}
</script>
<style lang="scss" scoped>
.workspace {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  height: 100%;
}
</style>
